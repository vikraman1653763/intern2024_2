<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>OpenLayers Map</title>
    <!-- Add OpenLayers library -->
    <script src="/static/resources/ol/ol.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ol@6.8.1/dist/ol.js"></script>
    <!-- Add OpenLayers CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@6.8.1/dist/ol.css">
    <link rel="stylesheet" href="/static/styles/mapstyle.css">
  
</head>
<body>
    <!-- Map container -->
    <div id="map"></div>
    
    <!-- Popup container -->
    <div id="popup" class="ol-popup">
        <a href="#" id="popup-closer" class="ol-popup-closer"></a>
        <div id="popup-content"></div>
    </div>

    <script>
        var mapView = new ol.View({
            center: ol.proj.fromLonLat([80.2707, 13.0827]),
            zoom: 4.5
        });
        var map = new ol.Map({
            target: 'map',
            view: mapView,
            controls: []
        });
    
        var osmTile = new ol.layer.Tile({
            source: new ol.source.OSM()
        });
        map.addLayer(osmTile);
        var wmsSource= new ol.source.TileWMS({
            url: "http://localhost:8080/geoserver/Nevar/wms",
            params: { 'LAYERS': 'Nevar:state', 'TILED': true },
            serverType: "geoserver",
            visible: true,
            transition:0
        })
        var indiaState = new ol.layer.Tile({
            source: wmsSource
        });
        
        map.addLayer(indiaState);
        
    
        var container = document.getElementById('popup');
        var content = document.getElementById('popup-content');
        var closer = document.getElementById('popup-closer');
    
        var overlay = new ol.Overlay({
            element: container,
            autoPan: true,
            autoPanAnimation: {
                duration: 250
            }
        });
        map.addOverlay(overlay);
    
        closer.onclick = function () {
            popup.setPosition(undefined);
            closer.blur();
            return false;
        };

        //map.on('click', function(e){
        //    console.log(e.coordinate[0], e.coordinate[1]);
        //   overlay.setPosition(e.coordinate);
         //  content.innerHTML='hi';
       // })
       map.on('singleclick', function (evt) {
        const viewResolution = /** @type {number} */ (map.getView().getResolution());
        const url = wmsSource.getFeatureInfoUrl(
          evt.coordinate,
          viewResolution,
          'EPSG:3857',
          {'INFO_FORMAT': 'application/json',
            'propertyName': 'State_Name'    
        });
        if (url) {
          console.log(url);
         $.getJSON(url, function(data){
            var feature=data.features[0];
            var props=feature.properties;
             overlay.setPosition(evt.coordinate); 
         })

        }else{
            overlay.setPosition(undefined);
        }
      });
    </script>
    
</body>
</html>
